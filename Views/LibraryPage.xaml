<Page x:Class="SLSKDONET.Views.LibraryPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      mc:Ignorable="d" 
      d:DesignHeight="600" d:DesignWidth="1000"
      Title="LibraryPage">

    <Grid Background="{StaticResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header with View Tabs -->
        <Border Grid.Row="0" Background="{StaticResource SecondaryBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1" Padding="20,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,12,0">
                    <Button Content="ðŸ’¿ Albums" 
                            Command="{Binding ChangeViewModeCommand}" 
                            CommandParameter="Albums"
                            Style="{StaticResource ModernButtonStyle}"
                            Height="36" Padding="16,0"
                            Background="{StaticResource AccentBrush}"
                            Foreground="White" Margin="0,0,8,0"/>
                    <Button Content="ðŸŽµ Tracks" 
                            Command="{Binding ChangeViewModeCommand}" 
                            CommandParameter="Tracks"
                            Style="{StaticResource ModernButtonStyle}"
                            Height="36" Padding="16,0" Margin="0,0,12,0"/>
                </StackPanel>

                <TextBlock Grid.Column="1" 
                           Text="{Binding StatusText, FallbackValue='Ready'}" 
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           FontSize="12" FontStyle="Italic" Margin="16,0"/>

                <Button Grid.Column="2"
                        Content="ðŸ”„ Rescan"
                        Command="{Binding RescanLibraryCommand}"
                        Style="{StaticResource ModernButtonStyle}"
                        Height="36" Padding="16,0"
                        Background="{StaticResource AccentBrush}"
                        Foreground="White" Margin="16,0,0,0"/>
            </Grid>
        </Border>

        <!-- Content Area -->
        <Grid Grid.Row="1">
            <!-- Albums View -->
            <ItemsControl ItemsSource="{Binding LibraryEntries}"
                          Visibility="{Binding CurrentViewMode, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Albums, FallbackValue=Visible}"
                          Padding="20">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel ItemWidth="180" ItemHeight="220"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{StaticResource SurfaceBrush}"
                                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                                CornerRadius="8" Margin="8" Padding="12">
                            <StackPanel>
                                <TextBlock Text="ðŸŽµ" FontSize="48" 
                                           Foreground="{StaticResource AccentBrush}"
                                           HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBlock Text="{Binding Album, FallbackValue='Unknown Album'}"
                                           FontWeight="Bold" Foreground="{StaticResource TextBrush}"
                                           TextTrimming="CharacterEllipsis" Height="40"/>
                                <TextBlock Text="{Binding Artist, FallbackValue='Unknown Artist'}"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           FontSize="11" Margin="0,4,0,0" TextTrimming="CharacterEllipsis"/>
                                <TextBlock Text="{Binding Format, FallbackValue='mp3'}"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           FontSize="10" Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Tracks View -->
            <DataGrid ItemsSource="{Binding LibraryEntries}"
                      Visibility="{Binding CurrentViewMode, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Tracks, FallbackValue=Collapsed}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      Background="{StaticResource BackgroundBrush}"
                      Foreground="{StaticResource TextBrush}"
                      RowBackground="{StaticResource SecondaryBackgroundBrush}">
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="{StaticResource SurfaceBrush}"/>
                        <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                        <Setter Property="Padding" Value="12,8"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Artist" 
                                        Binding="{Binding Artist}" 
                                        Width="180"/>
                    <DataGridTextColumn Header="Title" 
                                        Binding="{Binding Title}" 
                                        Width="*" MinWidth="250"/>
                    <DataGridTextColumn Header="Album" 
                                        Binding="{Binding Album}" 
                                        Width="180"/>
                    <DataGridTextColumn Header="Format" 
                                        Binding="{Binding Format}" 
                                        Width="80"/>
                    <DataGridTextColumn Header="Bitrate" 
                                        Binding="{Binding Bitrate, StringFormat={}{0} kbps}" 
                                        Width="100"/>
                    <DataGridTextColumn Header="User" 
                                        Binding="{Binding Username}" 
                                        Width="120"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Page>