<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:SLSKDONET.ViewModels"
             x:Class="SLSKDONET.Views.Avalonia.QueuePanel"
             Background="#1E1E1E">
    
    <Design.DataContext>
        <vm:PlayerViewModel />
    </Design.DataContext>
    
    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#252525" Padding="16,12" BorderBrush="#333" BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Play Queue" FontSize="16" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="{Binding Queue.Count, StringFormat='{}{0} tracks'}" 
                               FontSize="12" Foreground="#888" Margin="0,4,0,0"/>
                </StackPanel>
                
                <Button Grid.Column="1" 
                        Command="{Binding ClearQueueCommand}"
                        Background="Transparent"
                        Foreground="#FF6B6B"
                        Padding="12,6"
                        ToolTip.Tip="Clear queue">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="ðŸ—‘ï¸"/>
                        <TextBlock Text="Clear"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>
        
        <!-- Queue List -->
        <ListBox Grid.Row="1" 
                 ItemsSource="{Binding Queue}"
                 SelectedIndex="{Binding CurrentQueueIndex}"
                 Background="Transparent"
                 BorderThickness="0"
                 Padding="0">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border Padding="12,8" 
                            Background="{Binding IsSelected, Converter={StaticResource BoolToBackgroundConverter}}"
                            CornerRadius="4"
                            Margin="8,2">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            
                            <!-- Playing Indicator -->
                            <TextBlock Grid.Column="0" 
                                       Text="â–¶ï¸" 
                                       FontSize="14"
                                       Margin="0,0,12,0"
                                       IsVisible="{Binding $parent[ListBox].DataContext.CurrentTrack, Converter={StaticResource EqualityConverter}, ConverterParameter={Binding}}"/>
                            
                            <!-- Track Info -->
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="{Binding Title}" 
                                           FontWeight="Medium" 
                                           Foreground="White"
                                           TextTrimming="CharacterEllipsis"/>
                                <TextBlock Text="{Binding Artist}" 
                                           FontSize="12" 
                                           Foreground="#888"
                                           TextTrimming="CharacterEllipsis"
                                           Margin="0,2,0,0"/>
                            </StackPanel>
                            
                            <!-- Remove Button -->
                            <Button Grid.Column="2"
                                    Command="{Binding $parent[ListBox].DataContext.RemoveFromQueueCommand}"
                                    CommandParameter="{Binding}"
                                    Background="Transparent"
                                    Foreground="#888"
                                    Padding="8"
                                    ToolTip.Tip="Remove from queue">
                                <TextBlock Text="âœ•" FontSize="16"/>
                            </Button>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
        
        <!-- Controls Footer -->
        <Border Grid.Row="2" Background="#252525" Padding="12" BorderBrush="#333" BorderThickness="0,1,0,0">
            <Grid ColumnDefinitions="*,Auto,Auto">
                
                <!-- Shuffle & Repeat -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                    <ToggleButton IsChecked="{Binding IsShuffling}"
                                  Command="{Binding ToggleShuffleCommand}"
                                  Padding="10,6"
                                  ToolTip.Tip="Shuffle">
                        <TextBlock Text="ðŸ”€" FontSize="16"/>
                    </ToggleButton>
                    
                    <Button Command="{Binding ToggleRepeatCommand}"
                            Padding="10,6"
                            ToolTip.Tip="{Binding RepeatMode}">
                        <TextBlock Text="{Binding RepeatMode, Converter={StaticResource RepeatModeIconConverter}}" 
                                   FontSize="16"/>
                    </Button>
                </StackPanel>
                
                <!-- Track Count -->
                <TextBlock Grid.Column="1" 
                           Text="{Binding CurrentQueueIndex, StringFormat='Track {0} of'}"
                           Foreground="#888"
                           VerticalAlignment="Center"
                           Margin="0,0,4,0"/>
                <TextBlock Grid.Column="2" 
                           Text="{Binding Queue.Count}"
                           Foreground="White"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
        
    </Grid>
    
</UserControl>
